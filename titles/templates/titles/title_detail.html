{% extends 'base2.html' %}
{% load static humanize %}
{#{% block title %}{% endblock %}#}
{% block content %}
<div class="still-background">
    <img class="backdrop" src="{% static 'img/1280.jpg' %}">
</div>

<div class="ui main text container">
    <img class="title-poster" src="{% static 'img/w185_h278_bestv2.jpg' %}">
{#    <div class="ui cards title-poster">#}
{#        {% include 'titles/title_card.html' with title=title score=current_rating.rate in_fav=title.has_in_favourites %}#}
{#    </div>#}
    <h1 class="title-name">{{ title.name }}</h1>
    <p>genres</p>


    <div class="ui pointing secondary menu user-menu">
        <a class="item active" data-tab="first">Your data</a>
        <a class="item" data-tab="second">Social</a>
        <a class="item" data-tab="third">Pictures</a>
    </div>

<div class="ui tab segment active" data-tab="first"><h3 class="ui header"></h3><img class="ui wireframe image" src="/images/wireframe/paragraph.png"><img class="ui wireframe image" src="/images/wireframe/paragraph.png"></div>
<div class="ui tab segment" data-tab="second"><h3 class="ui header"></h3><img class="ui wireframe image" src="/images/wireframe/paragraph.png"><img class="ui wireframe image" src="/images/wireframe/paragraph.png"></div>
<div class="ui tab segment" data-tab="third"><h3 class="ui header"></h3><img class="ui wireframe image" src="/images/wireframe/paragraph.png"><img class="ui wireframe image" src="/images/wireframe/paragraph.png"></div>
<div class="ui tab segment" data-tab="fourth"><h3 class="ui header">4th</h3><img class="ui wireframe image" src="/images/wireframe/paragraph.png"><img class="ui wireframe image" src="/images/wireframe/paragraph.png"></div>



<table>
    {% for rating in data.user_ratings_of_title %}
        <tr>
            <td class=""><a href="{% url 'title-list' %}?year={{ rating.rate_date|date:'Y' }}&month={{ rating.rate_date|date:'m' }}">{{ rating.rate_date|date:"Y-m-d" }}</a></td>
            <td class=""><a href="{% url 'title-list' %}?r={{ rating.rate }}">{{ rating.rate }}</a>
            {% with rating.rated_before_rate_diff as rate_diff %}
            {% if rate_diff != None %}
                {% if rate_diff > 0 %}
                <span class="increase">(+{{ rating.rated_before_rate_diff }})</span>
                {% elif rate_diff == 0 %}
                <span class="">==</span>
                {% else %}
                <span class="decrease">({{ rate_diff }})</span>
                {% endif %}
            {% endif %}
            {% endwith %}
            </td>
            <td class="text-center">duration: {{ rating.next_rating_days_diff }} days</td>
            <td>
                <form action="" method="post">{% csrf_token %}
                    <button class="btn btn-sm see-again-btn unwatch-btn" type="submit" name="delete_rating" value="delete_rating"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span> delete</button>
                    <input type="hidden" name="rating_pk" value="{{ rating.pk }}">
                </form>
            </td>
        </tr>
    {% endfor %}
</table>

{% with user_ratings_of_title.0 as current_rating %}
    <div class="ui cards">
        {% include 'titles/title_card.html' with title=title score=current_rating.rate in_fav=title.has_in_favourites %}
    </div>
    <div class="ui checkbox">
      <input type="checkbox" name="insert_as_new">
      <label for="insert_as_new">insert as a new rating?</label>
    </div>
    <br>
    {% if user_ratings_of_title %}
        <a href="{% url 'rating-update' current_rating.pk %}" class="label label-default">
            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> modify current rating
        </a>
    {% endif %}
{% endwith %}

<div class="ui header">Recommend this title</div>
<div class="ui fluid multiple search selection dropdown">
  <input type="hidden" name="country">
  <i class="dropdown icon"></i>
  <div class="default text">People you follow</div>
  <div class="menu">
      {% for userfollow in followed_title_not_recommended %}
        <div class="item" data-value="{{ userfollow.followed.username }}"><img class="ui mini avatar image" src="{% static 'img/stevie.jpg' %}">{{ userfollow.followed.username }}</div>
      {% endfor %}
    </div>
</div>

<div class="ui header">Followed users who saw this title too</div>
{% for userfollow in followed_saw_title %}
{#    todo color depends on rating#}
    <a href="{% url 'user-detail' userfollow.followed.username %}" class="ui teal image label">
      <img src="{% static 'img/stevie.jpg' %}">
      {{ userfollow.followed.username }}
      <div class="detail">{{ userfollow.user_rate }} on {{ userfollow.user_rate_date }}</div>
{#    {{ user.username }} rated this {{ user.followed_curr_rating }}#}
    </a>
{% endfor %}

<div class="ui header">Main cast and their other appearances</div>
{% for actor, titles in actors_and_other_titles %}
    <h4 class="ui header">{{ actor.name }}</h4>
    {% for title in titles %}
{#        show left corner label only if rated#}
        {% include 'titles/title_small.html' with title=title rate=title.user_rate %}
    {% endfor %}
{% endfor %}

<div class="ui header">Similar titles</div>


    <br>
    <br>
    <a href="{{ title.url_imdb }}" target="_blank">
        <img class="img-rounded" src="{% static 'img/imdb.png' %}" alt="..." style="width: 70px">
    </a>
    <a href="{{ title.url_tomato }}" target="_blank">
        <img class="img-rounded" src="{% static 'img/rt.png' %}" alt="..." style="width: 70px">
    </a>

    {{ title.plot }}

                    <ul class="list-group marginleft">
                        <li class="list-group-item">
                            {% for genre in title.genre.all %}
                                <a href="{{ genre.get_absolute_url }}">{{ genre.name }}<br></a>
                            {% endfor %}
                        </li>
                        <li class="list-group-item">director:
                            {% for director in title.director.all %}
                                <a href="{{ director.get_absolute_url }}">{% if director.name != 'N/A' %}{{ director.name }}{% else %}unknown{% endif %}<br></a>
                            {% endfor %}
                        </li>

                        {% if title.runtime %}
                            <li class="list-group-item">Runtime: {{ title.runtime }} mins</li>
                        {% endif %}

                        {% if title.votes %}
                            <li class="list-group-item">IMDb votes: {{ title.votes|intcomma }}</li>
                        {% endif %}

                        {% if title.rate_imdb %}
                            <li class="list-group-item">Avg IMDb ratings: {{ title.rate_imdb }}</li>
                        {% endif %}

                        {% with title.rate as data %}
                            {% if data.count %}
                                <li class="list-group-item">Avg ratings: {{ data.avg|floatformat:2 }}
                                    <a href="{% url 'user-list' %}?const={{ title.const }}">({{ data.count }} user{{ data.count|pluralize }})</a>
                                </li>
                            {% endif %}
                        {% endwith %}
                    </ul>
        </div>

{% endblock %}

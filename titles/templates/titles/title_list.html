{% extends 'base.html' %}
{% load static widget_tweaks %}
{#{% block title %}{{ page_title }}{% endblock %}#}

{% block image %}
    {% if searched_user %}
        {% include 'accounts/includes/user_background.html' with user=searched_user %}
    {% endif %}
{% endblock %}

{% block breadcrumb %}
    <div class="ui breadcrumb">
        <a class="section" href="{% url 'home' %}">Home</a>
        <i class="right angle icon divider"></i>
        <a class="{% if not request.GET %}active {% endif %}section" href="{% url 'title-list' %}">Explore</a>
        {% if request.GET %}
            <i class="right angle icon divider"></i>
            <div class="active section">Search</div>
{#            <div class="active section">Search for: <a href="">{% for key, value in request.GET.items %}{{ key }}={{ value }}{% if not forloop.last %}, {% endif %}{% endfor %}</a></div>#}
        {% endif %}
    </div>
{% endblock %}

{% block content %}
    <div class="ui grid">
        <div class="row">
            <div class="column">
{#                * change card type to list (1 item per row)#}
                <div class="ui text menu">
                  <div class="header item">Showing</div>
                  <a class="item active">
                    Both
                  </a>
                  <a class="item">
                    Movies
                  </a>
                  <a class="item">
                    TV-Shows
                  </a>
                </div>
            </div>
{#            <div class="column">#}
{#                <div class="right floated ui text menu">#}
{#                  <div class="header item">Sort By</div>#}
{#                  <a class="item">#}
{#                    Closest#}
{#                  </a>#}
{#                  <a class="item">#}
{#                    Recent#}
{#                  </a>#}
{#                  <a class="item active">#}
{#                    Most Popular#}
{#                  </a>#}
{#                </div>#}
{#            </div>#}
        </div>
    </div>

    {% if searched_user %}
        <div class="ui centered grid">
            <h3 class="ui header">
{#                histogram#}
                {{ searched_user.username }}'s {{ paginator.count }} ratings
            </h3>
        </div>
        <div class="ui hidden divider"></div>
    {% endif %}

    {% include 'includes/form_errors.html' with form=search_form %}
    <form action="{% url 'title-list' %}">
        <div class="ui form">
            <div class="inline fields">
                <div class="four wide field">
                    {{ search_form.year.label_tag }}
                    {{ search_form.year }}
                </div>
                <div class="four wide field">
                    {{ search_form.genre.label_tag }}
                    {% render_field search_form.genre|add_class:'ui dropdown search' %}
                </div>
                <div class="eight wide field">
                    {% render_field search_form.keyword placeholder=search_form.keyword.label %}
                </div>
            </div>
            <button class="ui submit button">Submit</button>
        </div>
    </form>
    <div class="ui divider"></div>
    <div class="ui two column stackable grid">
        {% for title in title_list %}
            <div class="column">
                <div class="ui card backdrop-card">
                  <a href="{{ title.get_absolute_url }}" class="ui image">
                      {% if searched_user %}
                        <a class="ui left corner label red green">
                            <span class="icon">{{ title.searched_user_rate }}</span>
                        </a>
                      {% endif %}
                        <img src="{% static 'img/w500_and_h521_bestv2.jpg' %}">
    {#                <img src="{% static 'img/w500_and_h521_bestv2.jpg' %}" data-src="{% if title.img %}{{ title.img.url }}{% endif %}">#}
                  </a>
                  <div class="content">
                      <p class="header center aligned"><a href="{{ title.get_absolute_url }}">{{ title.name }}</a></p>
                    <div class="meta">
                      <span class="date">{{ title.plot|truncatewords:25|truncatechars:150 }}</span>
                    </div>
                    <div class="description">
                        <p>
                            {% for genre in title.genre.all %}
                                <a href="{{ genre.get_absolute_url }}">{{ genre.name }}{% if not forloop.last %},{% endif %}</a>
                            {% endfor %}
                            <span class="right floated">
                                <i class="calendar icon"></i> {{ title.year }}
                                <i class="star icon"></i>{{ title.rate_imdb }}
                            </span>
                        </p>
                    </div>
                  </div>
                  <div class="extra content">
                      <div class="ui star rating" data-url="{% url 'title-rate' title.pk %}" data-rating="{{ title.request_user_rate }}"></div>
                      <div class="right floated">
                          <i data-pk="{{ title.pk }}" class="{% if not title.has_in_favourites %}empty {% else %}active {% endif %}red heart icon large title-fav"></i>
                          <i data-pk="{{ title.pk }}" class="{% if not title.has_in_watchlist %}remove {% else %}active {% endif %}red bookmark icon large title-watch"></i>
    {#                      <button class="circular ui orange icon button"><i class="empty heart icon"></i></button>#}
    {#                    <a class="ui blue image label">#}
    {#                      <i class="add to calendar icon"></i>#}
    {#                      Fav#}
    {#                    </a>#}
    {#                    <span class="price"><i class="list small icon red" data-content="Watchlist" data-variation="mini"></i></span>#}
    {#                      <div class="ui heart rating red" type="tooltip" data-url="{% url 'title-fav' title.pk %}" data-rating="{{ title.has_in_favourites|yesno:"1,0" }}" data-max-rating="1" data-content="Favourite" data-variation="mini"></div>#}
    {#                    <a><i class="user icon"></i>22 Friends</a>#}
                      </div>
                  </div>
                </div>
            </div>
        {% endfor %}
    </div>

    {% include 'includes/pagination.html' %}
{% endblock %}
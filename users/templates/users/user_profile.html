{% extends "base.html" %}
{% load staticfiles %}
{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="row lower">
	<div class="col-md-12">
		<div class="page-header text-center">
			<span class="lead">{{ choosen_user.username }}</span>
				{% if request.user.is_authenticated and not is_owner %}
				<form id="follow_user" method="post" style="display: inline;">{% csrf_token %}
				{% if can_follow %}
					<button class="btn btn-sm see-again-btn watch-btn" type="submit" name="follow" value="follow">Follow user</button>
				{% else %}
					<button class="btn btn-sm see-again-btn unwatch-btn" type="submit" name="unfollow" value="unfollow">Unfollow user</button>
				{% endif %}
				</form>
				{% endif %}
			<p class="text-center text-lead"></p>
		</div>
	</div>
</div>

<div class="row">
	<div class="col-md-2 col-md-offset-5 col-xs-6 col-xs-offset-3">
		<img id="avatar" class="img-responsive img-thumbnail" src="{% if choosen_user.userprofile.picture %}{{ choosen_user.userprofile.picture.url }}{% else %}{% static 'img/placeholderavatar.png' %}{% endif %}" alt="...">
	</div>
</div>

<div class="row">
	<br>
	<div class="col-md-4 col-md-offset-4">
		<div class="btn-group text-center">
			<a href="{{ choosen_user.userprofile.watchlist_url }}">
                <button type="button" class="btn btn-sm btn-default"><span class="glyphicon glyphicon-list" aria-hidden="true"></span> watchlist</button>
            </a>
			<a href="{{ choosen_user.userprofile.favourite_url }}">
                <button type="button" class="btn btn-sm btn-default"><span class="glyphicon glyphicon-heart-empty" aria-hidden="true"></span> favourites</button>
            </a>
			<a href="{{ choosen_user.userprofile.recommend_url }}">
                <button type="button" class="btn btn-sm btn-default"><span class="glyphicon glyphicon-hand-right" aria-hidden="true"></span> recommendations</button>
            </a>
		</div>
	</div>
	<div class="col-md-4 col-md-offset-4">
		<div class="btn-group text-center">
        {% if is_owner %}
			<a href="{% url 'user_edit' choosen_user.username %}">
                <button type="button" class="btn btn-sm btn-default"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> edit</button>
            </a>
        {% endif %}
        {% if is_owner and user.userprofile.imdb_id and not user.userprofile.csv_ratings %}
            {% if user.userprofile.imdb_id %}
                <button class="btn btn-sm btn-default" type="submit" name="update_rss" value="update_rss">update ratings</button>
                <button class="btn btn-sm btn-default" type="submit" name="update_watchlist" value="update_watchlist">update watchlist</button>
            {% endif %}
            {% if not user.userprofile.csv_ratings %}
                <button class="btn btn-sm btn-default" type="submit" name="update_csv" value="update_csv">update csv</button>
            {% endif %}
        {% endif %}
        </div>
	</div>
</div>
{% if user_ratings.last_seen %}
<br>
<div class="row">
	<div class="col-sm-8 col-sm-offset-2">
		<div class="panel panel-success">
			<div class="panel-heading">Most Recently Rated</div>
			<div class="panel-body">
				<div class="row">
				{% for entry in user_ratings.last_seen %}
					<div class="col-xs-6 col-sm-2">
						<a href="{{ entry.title.get_absolute_url }}">
							<img class="img-rounded posterMin" src="{% if entry.title.img %}{{ entry.title.img.url }}
								{% else %}{% static 'img/holderbigger.png' %}{% endif %}" alt="...">
							<br>{{ entry.title.name|truncatechars:9 }}
							<br>
							{% if entry.rate %}
							<span class="glyphicon glyphicon-star {% if not is_owner %}green{% endif %}" aria-hidden="true"></span> {{ entry.rate }}
							{% endif %}
							{% if entry.req_user_curr_rating and not is_owner %}
							<span class="glyphicon glyphicon-star" aria-hidden="true"></span> {{ entry.req_user_curr_rating }}
							{% endif %}
						</a>
					</div>
				{% endfor %}
				</div>
				See all <a href="{{ choosen_user.userprofile.ratings_url }}">{{ choosen_user.userprofile.count_ratings }} ratings</a>
			</div>
		</div>
	</div>
</div>
{% endif %}
{% if user_ratings.common_with_req_user %}
<div class="row">
	<div class="col-xs-12 col-sm-8 col-sm-offset-2">
		<div class="panel panel-success">
			<div class="panel-heading">Compared to you</div>
			<div class="panel-body">
				{% if user_ratings.common_with_req_user.not_rated_by_req_user %}
				<div class="row">
					<p class="text-center lead">Titles {{ choosen_user.username }} liked that you haven't rated</p>
					{% for title in user_ratings.common_with_req_user.not_rated_by_req_user %}
					<div class="col-xs-6 col-sm-2">
						<a href="{{ title.get_absolute_url }}">
							<img class="img-rounded posterMin" src="{% if title.img %}{{ title.img.url }}
								{% else %}{% static 'img/holderbigger.png' %}{% endif %}" alt="...">
							<br>{{ title.name|truncatechars:9 }}
							<br>
							<span class="glyphicon glyphicon-star green" aria-hidden="true"></span> {{ title.user_rate }}
						</a>
					</div>
					{% endfor %}
				</div>
				{% if user_ratings.common_with_req_user.not_rated_by_req_user_count > 6 %}
				See all <a href="{{ choosen_user.userprofile.ratings_exclude }}">{{ user_ratings.common_with_req_user.not_rated_by_req_user_count }} titles</a> you haven't rated
				{% endif %}
				<hr>
				{% endif %}
				{% if user_ratings.common_with_req_user.higher %}
				<div class="row">
					<p class="text-center lead">Titles you rated higher</p>
					{% for title in user_ratings.common_with_req_user.higher %}
					<div class="col-xs-6 col-sm-2">
						<a href="{% url 'title_details' slug=title.slug %}">
							<img class="img-rounded posterMin" src="{% if title.img %}/media/{{ title.img }}
								{% else %}{% static 'img/holderbigger.png' %}{% endif %}" alt="...">
							<br>{{ title.name|truncatechars:9 }}
							<br>
							<span class="glyphicon glyphicon-star green" aria-hidden="true"></span> {{ title.user_rate }}
							<span class="glyphicon glyphicon-star" aria-hidden="true"></span> {{ title.req_user_rate }}
						</a>
					</div>
					{% endfor %}
				</div>
				<hr>
				{% endif %}
				{% if user_ratings.common_with_req_user.lower %}
				<div class="row">
					<p class="text-center lead">Titles you rated lower</p>
					{% for title in user_ratings.common_with_req_user.lower %}
					<div class="col-xs-6 col-sm-2">
						<a href="{% url 'title_details' slug=title.slug %}">
							<img class="img-rounded posterMin" src="{% if title.img %}/media/{{ title.img }}
								{% else %}{% static 'img/holderbigger.png' %}{% endif %}" alt="...">
							<br>{{ title.name|truncatechars:9 }}
							<br>
							<span class="glyphicon glyphicon-star green" aria-hidden="true"></span> {{ title.user_rate }}
							<span class="glyphicon glyphicon-star" aria-hidden="true"></span> {{ title.req_user_rate }}
						</a>
					</div>
					{% endfor %}
				</div>
				<hr>
				{% endif %}
				You and {{ choosen_user.username }} rated {{ user_ratings.common_with_req_user.count }} the same titles<br>
				{% if user_ratings.common_with_req_user.req_user_rate_avg %}
                You rated them {{ user_ratings.common_with_req_user.req_user_rate_avg|floatformat:2 }} and {{ choosen_user.username }} rated them {{ user_ratings.common_with_req_user.user_rate_avg|floatformat:2 }}<br>
				{% endif %}
				You saw {{ user_ratings.common_with_req_user.percentage }}% of {{ choosen_user.username }}'s
				<a href="{{ choosen_user.userprofile.ratings_url }}">{{ choosen_user.userprofile.count_ratings }} ratings</a><br>
			</div>
		</div>
	</div>
</div>
{% endif %}
{% if user_ratings.last_seen %}
<div class="row">
    <div class="col-md-10 col-md-offset-1">
        <div class="text-center">
            <div class="btn-group" role="group" aria-label="...">
                <a id="graph_genres" class="btn btn-default">genres</a>
                <a id="graph_months" class="btn btn-default">months</a>
                <a id="graph_rated" class="btn btn-default">rated</a>
                <a id="graph_year" class="btn btn-default">year</a>
            </div>
        </div>
        <div id="graph" style="margin-top: 3%"></div>
    </div>
</div>
{% endif %}
{% endblock %}
{% extends 'base.html' %}
{% load static %}
{#{% block title %}{{ page_title }}{% endblock %}#}

{% block breadcrumb %}
    <div class="ui breadcrumb">
        <a class="section" href="{% url 'home' %}">Home</a>
        <i class="right angle icon divider"></i>
        <a class="section" href="{% url 'user-list' %}">Users</a>
        <i class="right angle icon divider"></i>
        <a class="section active" href="{% url 'user-detail' user.username %}">{{ user.username }}</a>
    </div>
{% endblock %}

{% block image %}
    {% include 'accounts/includes/user_background.html' %}
{% endblock %}

{% block content %}
    <div class="ui centered grid">
        {% with user.imdb_url as imdb_url %}
            <div class="{% if imdb_url %}four{% else %}three{% endif %} columns">
                <a class="ui label">Watchlist</a>
                <a class="ui label">Favourites</a>
                <a class="ui label">Recommendations? get rid of it?</a>
                {% if imdb_url %}
                    <a href="{{ imdb_url }}" target="_blank">
                        <i class="imdb big yellow icon"></i>
                    </a>
                {% endif %}
            </div>
        {% endwith %}
    </div>

    {% if user.pk != request.user.pk %}
      <div{% if not request.user.is_authenticated %} type="tooltip" data-content="You must be logged in." data-variation="mini"{% endif %} class="ui small follow toggle button right floated{% if user.already_follows %} active{% endif %}" data-pk="{{ user.pk }}">{% if user.already_follows %}Followed{% else %}Follow{% endif %}</div>
    {% endif %}

    <div class="ui divider hidden"></div>
    {% if is_other_user %}
        <div class="ui fluid {% if is_other_user %}two{% endif %} item menu title-menu">
            <a class="item active" data-tab="first">Overview</a>
    {#        <a class="item" data-tab="second">Lists</a>#}
    {#        <a class="item" data-tab="third">Charts</a>#}
            {% if is_other_user %}
                <a class="item" data-tab="fourth">Compared with you</a>
            {% endif %}
        </div>
    {% endif %}
    {% if is_other_user %}
        <div class="ui tab segment active" data-tab="first">
    {% endif %}
        <div class="ui grid centered statistics">
          <div class="statistic">
            <div class="value">
              {{ user.total_ratings }}
            </div>
            <div class="label">
              Ratings
            </div>
          </div>
          <div class="statistic">
            <div class="value">
              {{ user.total_movies }}
            </div>
            <div class="label">
              Movies seen
            </div>
          </div>
          <div class="statistic">
            <div class="value">
              {{ user.total_series }}
            </div>
            <div class="label">
              Tv-shows seen
            </div>
          </div>
          <div class="statistic">
            <div class="value">
              {{ user.total_followers }}
            </div>
            <div class="label">
              Followers
            </div>
          </div>
        </div>
        <div class="ui segment">
          <span class="ui blue ribbon label">Currently watching</span>
            <div class="ui list">
                <div class="slick-carousel-small">
                    {% for title in currently_watching %}
                        <div>
                            {% include 'titles/includes/title_small_slick.html' with slick=True rate=title.user_rate rate2=title.request_user_rate is_owner=is_owner %}
                        </div>
                    {% empty %}
                        <p>Nothing found</p>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="ui segment">
          <span class="ui blue ribbon label">Activity</span>
            <span>{{ user.username }}'s latest ratings</span>
            <div class="ui list">
                <div class="slick-carousel-small">
                    {% for rating in rating_list %}
                        <div>
                            {% include 'titles/includes/title_small_slick.html' with slick=True title=rating.title rate_date=rating.rate_date rate=rating.rate rate2=rating.request_user_rate is_owner=is_owner %}
                        </div>
                    {% empty %}
                        <p>Nothing found</p>
                    {% endfor %}
                </div>
                {% if not rating_list %}
                    <p>Nothing found</p>
                {% else %}
                    <div class="ui hidden divider"></div>
                    <p><a href="{{ user.ratings_url }}" class="ui label">See all</a></p>
                {% endif %}
            </div>
        </div>
        <div class="ui segment">
          <span class="ui blue ribbon label">Feed</span>
            <span>Latest activity of users followed by {{ user.username }}</span>
            <div class="ui list">
                {% for rating in feed %}
                  <div class="item">
                    <img class="ui avatar image" src="{{ rating.user.avatar_url }}">
                    <div class="content">
                      <span>{{ rating.rate_date }}</span>
                        <div class="description"><a href="{{ rating.user.get_absolute_url }}">{{ rating.user.username }}</a> rated <a href="{{ rating.title.get_absolute_url }}"><b>{{ rating.title.name }}</b></a> {{ rating.rate }}<i class="icon star green"></i></div>
                    </div>
                  </div>
                {% endfor %}
                {% if not feed %}
                    <p>Nothing found</p>
                {% endif %}
            </div>
        </div>
    {% if is_other_user %}
        </div>
    {% endif %}

    {% if is_other_user %}
        <div class="ui tab segment" data-tab="fourth">
            {% if comparision %}
                <div class="ui grid centered statistics">
                  <div class="statistic">
                    <div class="value">
                      {{ comparision.common_titles_length }}
                    </div>
                    <div class="label">
                      the same titles
                    </div>
                  </div>
                  <div class="statistic">
                    <div class="value">
                      {{ comparision.percentage }}%
                    </div>
                    <div class="label">
                      Of his titles you saw
                    </div>
                  </div>
                  <div class="statistic">
                    <div class="value">
                      {{ comparision.averages.user }}
                    </div>
                    <div class="label">
                      He Rated them
                    </div>
                  </div>
                  <div class="statistic">
                    <div class="value">
                      {{ comparision.averages.request_user }}
                    </div>
                    <div class="label">
                      You rated them
                    </div>
                  </div>
                </div>
                <div class="ui segment">
                  <span class="ui teal ribbon label">Lower</span>
                    <span>{{ user.username }} rated lower</span>
                    <div class="ui list">
                        {% for title in comparision.titles_user_rate_lower %}
                            {% include 'titles/title_small.html' with title=title rate=title.user_rate rate2=title.request_user_rate %}
                        {% endfor %}
                        {% if not comparision.titles_user_rate_lower %}
                            <p>Nothing found</p>
                        {% endif %}
                    </div>
                </div>
                <div class="ui segment">
                  <span class="ui teal ribbon label">Higher</span>
                    <span>{{ user.username }} rated higher</span>
                    <div class="ui list">
                        {% for title in comparision.titles_user_rate_higher %}
                            {% include 'titles/title_small.html' with title=title rate=title.user_rate rate2=title.request_user_rate %}
                        {% endfor %}
                        {% if not comparision.titles_user_rate_higher %}
                            <p>Nothing found</p>
                        {% endif %}
                    </div>
                </div>
                <div class="ui segment">
                  <span class="ui teal ribbon label">The same</span>
                    <span>{{ user.username }} rated the same</span>
                    <div class="ui list">
                        {% for title in comparision.titles_rated_the_same %}
                            {% include 'titles/title_small.html' with title=title rate=title.user_rate rate2=title.request_user_rate %}
                        {% endfor %}
                        {% if not comparision.titles_rated_the_same %}
                            <p>Nothing found</p>
                        {% endif %}
                    </div>
                </div>
                <div class="ui segment">
                  <span class="ui teal ribbon label">You need to see</span>
                    <span>{{ user.username }} liked that you haven't seen</span>
                    <div class="ui list">
                        {% for title in comparision.titles_user_liked %}
                            {% include 'titles/title_small.html' with title=title rate=title.user_rate %}
                        {% endfor %}
                        {% if not comparision.titles_user_liked %}
                            <p>Nothing found</p>
                        {% endif %}
                    </div>
                </div>
            {% else %}
                <p>{{ user.username }} has no ratings</p>
            {% endif %}
        </div>
    {% endif %}
{% endblock %}
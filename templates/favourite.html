{% extends "base.html" %}
{% load staticfiles %}

{% block content %}
    {% if ratings %}
    <div id="favouritePage">
        <div class="container">
            <p class="lead text-center">Your favourite titles.</p>
            <ul id="sortable">
            {% for entry in ratings %}
                <li id="item-{{ entry.title.const }}" class="ui-state-default">
                    <!--<p class="glyphicon glyphicon-move" aria-hidden="true" style="float: left; line-height: 50px;"></p>-->
                    <p id="item-order" class="" style="float: left; line-height: 50px; margin-right: 10px;">{{ entry.order }}</p>
                    <img class="img-responsive img-rounded"
                         src="{% if entry.title.img_thumbnail %}{{ entry.title.img_thumbnail.url }}{% else %}{% static 'img/holderbigger.png' %}{% endif %}"
                         style="width: 35px; float: left; margin-right: 10px; " alt="...">
                    <a href="{{ entry.title.get_absolute_url }}" style="line-height: 50px;">{{ entry.title.name }}</a>
                    {% if is_owner %}
                    <form method="post" style="float: right;">{% csrf_token %}
                        <a href="#" data-toggle="tooltip" title="Delete from favourites!">
                            <button class="btn-danger glyphicon glyphicon-heart-empty" type="submit" name="unfav" value="{{ entry.title.const }}"></button>
                        </a>
                        <input name="const" value="{{ entry.title.const }}" hidden>
                    </form>
                    {% endif %}
                </li>
            {% endfor %}
            </ul>

        <table id="sortable" class="table table-hover table-bordered table-condensed">
            <tbody>
                {% for obj in ratings %}
                <tr id="item-{{ obj.title.const }}" class="ui-state-default result result-{% cycle 'odd' 'even' %}">
                    <td class="col-md-9 paddingleft">
                        <img class="img-responsive img-rounded"
                         src="{% if obj.title.img_thumbnail %}{% if obj.title.img_thumbnail.url %}{{ obj.title.img_thumbnail.url }}{% else %}/media/{{ obj.title.img }}{% endif %}
                            {% else %}{% static 'img/holderbigger.png' %}{% endif %}"
                         style="width: 35px; float: left; margin-right: 10px; " alt="...">
                        <a href="{% url 'title_details' slug=obj.title.slug %}">{{ obj.name }} ({{ obj.year }})</a>
                        {% if obj.runtime %}{{ obj.runtime }} min{% endif %}
                        <span style="float: right;">
                            {% if obj.user_curr_rating %}
                                {{ obj.user_curr_rating }}
                                <span class="glyphicon glyphicon-star green" aria-hidden="true"></span>
                            {% endif %}

                            {% if obj.req_user_curr_rating %}
                                {{ obj.req_user_curr_rating }}
                                <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
                            {% endif %}
                            {% if request.user.is_authenticated %}
                                {% include 'includes/favourites.html' with condition=obj.has_in_favourites const=obj.const %}
                                {% include 'includes/watchlist.html' with condition=obj.has_in_watchlist const=obj.const %}
                            {% endif %}
                        </span>
                        <p style="font-style:italic; font-size:12px">
                            {% for genre in obj.genre.all %}
                                <a href="{{ genre.get_absolute_url }}">{{ genre.name }}</a>
                                {% include 'includes/comma.html' %}
                            {% endfor %}
                            dir:
                            {% for director in obj.director.all %}
                                <a href="{{ director.get_absolute_url }}">
                                    {% if director.name != 'N/A' %}{{ director.name }}{% else %}unknown{% endif %}
                                </a>
                                {% include 'includes/comma.html' %}
                            {% endfor %}
                        </p>
                        {% if request.user.is_authenticated %}
						<form class="star_rating_form_many" action="" method="post" const="{{ obj.const }}">{% csrf_token %}
                            <input name="const" value="{{ obj.const }}" hidden>
							<span class="starRating">
							{% for i in loop %}
								<input id="rating{{ i }}{{ obj.const }}" type="radio" name="rating" value="{{ i }}">
								<label for="rating{{ i }}{{ obj.const }}">{{ i }}</label>
							{% endfor %}
							</span>
						</form>
                        {% endif %}

                        {% if obj.plot %}
                        <p style="padding-left: 10px">{{ obj.plot|truncatechars:250 }}</p>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
            <span class="text-center">You can reorder the list by dragging title while holding LMB.</span>
        </div>
    </div>
    {% else %}
    <p class="text-center">You have no favourite titles!</p>
    {% endif %}
{% endblock %}
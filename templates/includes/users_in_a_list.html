{% load staticfiles %}
{% if ratings.paginator.num_pages > 1 %}
    {% include 'includes/paginator.html' %}
{% endif %}

{% for user in user_list %}
<div class="col-md-12">
    <div class="well usersList{% if request.user == user %} userListOwner{% endif %}">
        <a href="{{ user.userprofile.get_absolute_url }}">
            <img id="avatar" class="img-responsive img-thumbnail avatarMin" style="float:left;margin-right: 10px"
                 src="{% if user.userprofile.picture %}{{ user.userprofile.picture.url }}{% else %}{% static 'img/placeholderavatar.png' %}{% endif %}" alt="...">
        </a>

        <p>
            {% with ratings.start_index|default:1 as index %}
                <span>{{ forloop.counter0|add:index }}</span>.
            {% endwith %}
            <a href="{{ user.userprofile.get_absolute_url }}">
                <strong>{{ user.username }}</strong>
            </a>
			{% if request.user.is_authenticated and not request.user == user %}
				{% if not user.already_follows %}
					<button class="btn btn-sm see-again-btn watch-btn" type="submit" name="follow" value="{{ user.username }}"><span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span> Follow</button>
				{% else %}
					<button class="btn btn-sm see-again-btn unwatch-btn" type="submit" name="unfollow" value="{{ user.username }}"><span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span> Unfollow</button>
				{% endif %}
			{% endif %}
        </p>

        {% if user.current_rating %}
            {% for i in 'xxxxxxxxxx' %}
                <span class="glyphicon glyphicon-star{% if forloop.counter > user.current_rating %}-empty{% endif %}" aria-hidden="true"></span>
            {% endfor %}
        {% endif %}

        {% with user.userprofile.avg_of_current_ratings as user_current_ratings %}
            {% if user_current_ratings.count %}
                <p>See all <a href="{{ user.userprofile.ratings_url }}">{{ user_current_ratings.count }} rated titles</a>
                    (avg: {{ user_current_ratings.avg|floatformat:2 }})
                </p>
            {% else %}
                <p style="font-size:11px"><em>User hasn't rated anything yet.</em></p>
            {% endif %}
        {% endwith %}
        <hr class="visible-xs">
        <div>
            <a href="{{ user.userprofile.watchlist_url }}" class="btn btn-xs btn-default">
                <span class="glyphicon glyphicon-list" aria-hidden="true"></span> watchlist
            </a>
            <a href="{{ user.userprofile.favourite_url }}" class="btn btn-xs btn-default">
                <span class="glyphicon glyphicon-heart-empty" aria-hidden="true"></span> favourites
            </a>
            <a href="{{ user.userprofile.recommend_url }}" class="btn btn-xs btn-default">
                <span class="glyphicon glyphicon-hand-right" aria-hidden="true"></span> recommend
            </a>
        </div>
    </div>
</div>
{% endfor %}

{% if ratings.paginator.num_pages > 1 %}
    {% include 'includes/paginator.html' %}
{% endif %}
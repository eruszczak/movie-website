{% extends "base.html" %}
{% load staticfiles %}
{% block title %}{{ entry.name }}{% endblock %}
{% block content %}

<div class="row" style="margin-top:-35px;">
	<div class="col-md-12">
		<div class="page-header">
			<h1 class="text-center">{{ entry.name }}</h1>
		</div>
		<div class="row">
			<div class="col-xs-6 col-sm-3 col-sm-offset-3 col-md-3 col-md-offset-3">
				<img class="img-responsive img-thumbnail" src="{% if entry.img %}{{ entry.img.url }}{% else %}{% static 'img/holderbigger.png' %}{% endif %}" alt="...">
			</div>

			<div class="col-xs-6 col-sm-3 col-md-3">
				<ul class="list-group" style="margin-left: -10px">
					<li class="list-group-item"><a href="{% url 'entry_show_from_year' year=entry.year %}">{{ entry.year }}</a></li>
					<li class="list-group-item">{% for genre in entry.genre.all %}
						<a href="{% url 'entry_show_from_genre' genre=genre.name %}">{{ genre.name }}<br></a>
						{% endfor %}</li>
					<li class="list-group-item">{% for director in entry.director.all %}
						<a href="{% url 'entry_show_from_director' pk=director.id %}">{% if director.name != 'N/A' %}{{ director.name }}{% else %}unknown director{% endif %}<br></a>{% endfor %}
					</li>
					{% comment %}
					{% if entry.votes != 'N/A' %}<li class="list-group-item">{{ entry.votes }} votes</li>{% endif %}
						<li class="list-group-item">current rating: <a href="{% url 'entry_show_from_rate' rate=entry.rate %}">{{ entry.rate }}</a></li>
					{% if entry.rate_imdb >= 1  %}<li class="list-group-item">imdb rating: {{ entry.rate_imdb }}</li>{% endif %}
					<li class="list-group-item">rated on: <a href="{{ link_month }}">{{ entry.rate_date|date:"d.m.Y" }}</a>
						{% if entry.yesterday_today_month %}
							<span class="label {% if entry.yesterday_today_month == 'this month' %}label-info{% else %}label-warning{% endif %}">
								{{ entry.yesterday_today_month }}
							</span>
						{% endif %}
					</li>
					{% endcomment %}
					{% if user.is_superuser %}
					<li class="list-group-item">
						<a href="{% url 'entry_edit' slug=entry.slug %}" class="label label-default">change rating</a>
						<form action="" method="post">{% csrf_token %}
							{% if watchlist %}
                                <button class="btn btn-sm see-again-btn unwatch-btn" type="submit" name="unwatch" value="unwatch">Don't want to see again</button>
							{% else %}
                                <button class="btn btn-sm see-again-btn watch-btn" type="submit" name="watch" value="watch">Want to see again</button>
							{% endif %}
							<br>
                            {% if not favourite %}
                                <button class="btn btn-sm" type="submit" name="fav_add" value="add">favourite</button>
                            {% else %}
                                <button class="btn btn-sm" type="submit" name="fav_remove" value="delete">unfavourite</button>
                            {% endif %}
						</form>
					</li>
					{% endif %}
				</ul>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-10 col-xs-offset-1"><br>
				<div class="progress">
					<div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" style="width: {{ entry.rate }}0%">{{ entry.rate }}/10</div>
                </div>
				{{ entry.plot }}
			</div>
		</div>

		<div class="row">
			<div class="col-md-2 hidden-xs"></div>
			<div class="col-xs-2 visible-xs"></div>
			<div class="col-xs-10 col-md-5">
			{% if archive %}
				<div class="history">
					<p class="lead"><br>History of ratings:</p>
					<table class="table-bordered table-condensed">
						<thead>
							<tr>
								<th class="text-center">title</th>
								<th class="text-center">rating</th>
								<th class="text-center">rated</th>
							</tr>
						</thead>
                    	<tbody>
						{% for a in archive %}
							<tr>
								<td class=""><a href="{% url 'entry_show_rated_in_month' year=a.rate_date|date:'Y' month=a.rate_date|date:'m' %}">{{ a.rate_date|date:"Y-m-d" }}</a></td>
								<td class=""><a href="{% url 'entry_show_from_rate' rate=a.rate %}">{{ a.rate }}</a></td>
								<td class="text-center">duration: {{ a.next_rating_days_diff }} days</td>
							</tr>
						{% endfor %}
						<tbody>
					</table>
				</div>
			{% endif %}
			</div>
			<div class="col-xs-2 visible-xs"></div>
			<div class="col-xs-10 col-md-5">
				<p class="lead"><br>Find out more:</p>
				<ul>
					<li><a href="{{ entry.url_imdb }}">imdb</a></li>
					<li><a href="{{ entry.url_tomato }}">rotten tomatoes</a></li>
					<li><a href="{% url 'entry_details_redirect' const=entry.const %}">shorter link</a></li>
{#					<li><a id="watchlist-link" href="{% url 'watchlist' username %}">see watchlist</a></li>#}
				</ul>
			</div>
		</div>


		{% comment %}
		<br>
		{% if episodes %}
			<div class="row">
				<div class="col-xs-7">
					{% for season, eps in episodes %}
					<div id="accordion" role="tablist" aria-multiselectable="true">
					  <div class="panel panel-default">
						<div class="panel-heading" role="tab" id="heading{{season}}">
						  <h4 class="panel-title">
							<a data-toggle="collapse" data-parent="#accordion" href="#collapse{{season}}" aria-expanded="true" aria-controls="collapse{{season}}">
							  season {{ season }}
							</a>
						  </h4>
						</div>
						<div id="collapse{{season}}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading{{season}}">
							{% for e in eps %}
								{{ e.number }} {{ e.name }} <br>
							{% endfor %}
						</div>
					  </div>
					</div>
						{% endfor %}
				</div>
			</div>
		{% endif %}
		{% endcomment %}
</div>
	</div>
{% endblock %}